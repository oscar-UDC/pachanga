# Funcionamiento
Para localización se ha empleado la API propuesta en clase de Google Maps Platform. Con ella, en el fragment principal se han incluido ya un mapa funcional en el que se muestra nuestra ubicación en todo momento tras pedirle los permisos requeridos al usuario. Esta ubicación se actualiza mediante un _request_ cada cierto intervalo de tiempo. Cabe destacar un problema que no hemos conseguido solucionar a lo largo de todo el proyecto, cada vez que se accede por primera vez a la aplicación, o en su defecto cada vez que se pregunta por los permisos de localización si estes no han sido dados permanentemente. Si el usuario da los permisos, el mapa no se actualiza directamente con la localización, sino que es necesario cambiar de fragment y regresar al mismo del mapa para poder ver tu ubicación y todos los eventos próximos.

En el mapa se puede clicar él cualquier ubicación, la cual se marcará con un indicador rojo. Esta será la ubicación que se entiende como que el usuario quiere emplear para crear el evento. Se procede a habilitar el botón de + Evento y así se puede acceder al fragment de creación.

## Eventos en Mapa
Como se ha dicho anteriormente, los eventos que se muestran en el mapa serán aquellos guardados en Firebase, que tienen una fecha futura y más importante, aquellos que se encuentran en el límite de distancia definido en ajustes. Por defecto, la distancia de los eventos a mostrar con respecto a la localización actual es de 5 kilómetros, pero esta se puede ajustar a cualquier valor en el settings fragment. Los marcadores de los eventos cambiarán dependiendo del tipo de evento (Casual o torneo). Además, todos los eventos que se muestran en el mapa pueden ser clicados para acceder a su información directamente.

## Como llegar
En cada evento, como se ha dicho en otras secciones de esta wiki existe un botón de Como llegar. Este botón nos direcciona a un nuevo fragment en el cual el usuario podrá ver una estimación de una ruta de como llegar a la dirección del evento con unas líneas indicativas. Para ello se ha usado la API de Directiins. Si el usuario así lo prefiere, puede clicar en este mapa, en el marcador rojo de destino y pudiendo verlo en Google Maps, o bien puede clicar en él y acceder al creador de rutas de Google Maps en la aplicación externa. En nuestra app además se mostrará una estimación de la distancia y duración del trayecto. La estimación de la duración se hace para un método de transporte por defecto. En caso de que la ruta sea inferior a 1.5 kilómetros, siempre se mide andando. En casos superiores, el usuario puede indicar en su settings fragment cuál quiere que sea el método de desplazamiento por defecto. Andar no es una opción, puesto que puede no ser asequibles para distancias largas, y además genera problemas en la API de Directions para casos de larga distancia.

<img src="https://github.com/rubenTome/APM/blob/main/Imagenes%20Ilustrativas/ruta.png" width="500" height="450">
<img src="https://github.com/rubenTome/APM/blob/main/Imagenes%20Ilustrativas/settings.png" width="500" height="450">

